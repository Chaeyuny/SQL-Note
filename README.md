# SQL-Note
업무하면서 알게 된 DB 지식 정리(Oracle) 


- 일하면서 바탕화면 메모지에 적어두고 활용했던 SQL 관련 지식
- 에러 발생 시 검색해서 해결했던 내용 포함
- 메모 내용 + 추가로 찾아보며 공부한 내용 정리

<br>
<br>

<h4>📌 힌트(hint) 사용 : 쿼리튜닝 </h4>
✔ 업무에서 가장 많이 활용되고 있었던 건 /*+parallel(4)*/, 때때로 /*+ordered use_nl(a b c)*/

 1)  /*+parallel(4)*/
    : 검색해서 나오는 건 정확히는 /*+ PARALLEL(table_name, degree)*/ 
      실제로 쓸때는 그냥 숫자만 기재해서 활용했다. select 바로 옆에 붙여서 실행하면 적용된다. 
         ex) select /*+parallel(4)*/ from table_name;
     
      쉽게 말해 병렬처리문인데, 숫자는 degree를 의미한다. 
      참고한 사이트 설명상으로는 '하나의 operation 수행에 대한 serever process 개수'라고 기재되어있고, degree에 영향을 주는 요인들도 다양하다. 
      나는 힌트 이름이 병렬처리이니 쉽게 말해 한사람이 할 작업을 넷이서 하게끔 속도를 높여주는 것이라고 이해했다. (쿼리문에 따라 속도가 무조건 높아지진 않는다) 
      그러므로 숫자를 너무 높이면 서버에 과부하를 줄 수 있으니 주의해야 한다. 
      
  
  2) /*+ordered use_nl(a b c)*/
    : a b c는 테이블 alias 명이다. 
      /*+ordered*/는 from절 테이블 순서대로 조인하도록 하는 힌트(접근 순서 결정)
      
      /*+use_nl*/은  접근 방법을 결정하는 힌트절인데 NESTED LOOP JOIN 방식으로 조인하도록 유도한다. NESTED LOOP JOIN은 중첩 루프조인으로, 자바에서 중첩 FOR문 사용할때랑 동작방식이 비슷하다. 
      업무에서는 두 힌트를 같이 썼다. 찾아보니 USE_NL은 단독으로 사용하기도 하지만 업무에서처럼 OREDRED와 같이 조인순서를 지정하는 힌트와 함께 사용하는 것이 일반적이라고 한다. 
      
      
  ## /*+ LEADING (b, a, c) */ 
     : ordered 힌트절에 대해 찾다가 알게 된 힌트다. ordered가 from절에 기재된 순서대로 조인하기 때문에 프롬절에 종속적이라면. 해당 힌트는 그렇지 않다. 
     from에 기술된 테이블 순서와 관계없이 힌트에 직접 조인순서를 기술할 수 있기 때문이었다.
     
    
    <br>
    <br>
    💡 나는 업무 시 힌트가 있을 때와 없을 때 속도차이를 비교하며 사용했다. 
       시간을 최소화하기위해 rownum을 걸어 샘플 데이터만 나오도록 해서 테스트해보았는데, 패럴을 넣을 때와 넣지 않을 때, ordered를 사용할때와 사용하지 않을 때 등등 어떤 경우가 가장 데이터가 빨리 나오는지를 테스트한 후에야 본격적으로 추출을 시작했다. 
       힌트 쓴다고 무작정 빨라지는것은 아니었기 때문이다. 
       
   <br>   
   💬 추출 업무가 굉장히 많았기 때문에.. 결과물이 얼마나 빨리 나오느냐에 중점을 둘 수 밖에 없었다. <br>
   💬 나는 쿼리를 짜고 rownum 을 걸어 테스트해보는 과정을 좋아했다. 쿼리 전체를 몇시간씩 돌리다가 에러가 나면 비효율적이었기 때문에 빠르게 테스트해볼 수 있는 방법이 필요했다. 
    쿼리에 따라 다르긴 하지만 10개, 3개 정도만 샘플로 돌려보면 이 쿼리문이 제대로 동작하는지부터 확인할 수 있었다. 
    샘플로 나온 정보가 맞는지 시스템 화면과 비교해볼 수 있기도 하고, 샘플이 나오는 속도가 너무 오래걸리면 쿼리에 문제가 있는 경우가 대부분이었기 때문에 rownum 걸어서 확인하면 빠르게 수정할 수 있었다. <br>
    


*참고사이트
      https://devuna.tistory.com/35
      https://koeiking11.tistory.com/entry/%EC%98%A4%EB%9D%BC%ED%81%B4-%ED%9E%8C%ED%8A%B8-ordered-usenl
      https://exmemory.tistory.com/44
